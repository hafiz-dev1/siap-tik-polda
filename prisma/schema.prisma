// file: prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
  output   = "/app/generated/prisma-client"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Enum untuk Arah Surat (Masuk/Keluar)
enum ArahSurat {
  MASUK
  KELUAR
}

// Enum untuk Tipe Dokumen
enum TipeDokumen {
  NOTA_DINAS
  SURAT_BIASA
  SPRIN
  TELEGRAM
}

// Enum baru untuk Tipe User (Peran)
enum Role {
  SUPER_ADMIN
  ADMIN
}

// Model untuk pengguna yang bisa login, sekarang disebut Pengguna
model Pengguna {
  id                String    @id @default(uuid())
  nama              String    // Nama lengkap pengguna
  username          String    @unique
  nrp_nip           String?  
  password          String
  role              Role      @default(ADMIN) // Peran pengguna (Admin/Super Admin)
  profilePictureUrl String?   // URL foto profil (opsional)
  surat             Surat[]
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  deletedAt         DateTime?

  @@map("pengguna")
}

// Model utama untuk data surat
model Surat {
  id                      String     @id @default(uuid())
  nomor_agenda            String     @unique
  nomor_surat             String     @unique
  tanggal_surat           DateTime
  tanggal_diterima_dibuat DateTime
  perihal                 String     @db.Text
  asal_surat              String
  tujuan_surat            String
  arah_surat              ArahSurat
  tipe_dokumen            TipeDokumen
  tujuan_disposisi        String[]
  isi_disposisi           String     @db.Text
  id_operator             String
  operator                Pengguna   @relation(fields: [id_operator], references: [id]) // Relasi diperbarui ke model Pengguna
  lampiran                Lampiran[]
  deletedAt               DateTime?
  createdAt               DateTime   @default(now())
  updatedAt               DateTime   @updatedAt

  @@map("surat")
}

// Model untuk menyimpan file lampiran yang di-upload
model Lampiran {
  id          String   @id @default(uuid())
  nama_file   String
  path_file   String
  tipe_file   String
  ukuran_file Int
  id_surat    String
  surat       Surat    @relation(fields: [id_surat], references: [id], onDelete: Cascade)
  uploaded_at DateTime @default(now())

  @@map("lampiran")
}